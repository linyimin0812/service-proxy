# NGINX 代理配置文件
# 由 NGINX 代理配置管理系统自动生成
# 生成时间: 2026-02-08T02:30:33.602405


# 规则: /api -> host.docker.internal:8001
# 描述: API endpoint to host
location /api {
    # 路径重写：去除路径前缀
    rewrite ^/api(/.*)?$ $1 break;

    # 直接代理到目标主机:端口（避免在 server {} 中声明 upstream）
    # 如果配置时未填写 target_host，则默认使用宿主机 host.docker.internal
    proxy_pass http://host.docker.internal:8001;

    # 代理头设置
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # 超时设置
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;

    # 缓冲设置
    proxy_buffering on;
    proxy_buffer_size 4k;
    proxy_buffers 8 4k;
    proxy_busy_buffers_size 8k;

    # WebSocket 支持
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    # 仅在客户端请求升级时转发升级头，避免对普通请求强制发送 Connection: upgrade
    proxy_set_header Connection $http_connection;
}


# 规则: /admin -> host.docker.internal:9000
# 描述: Admin panel
location /admin {
    # 路径重写：去除路径前缀
    rewrite ^/admin(/.*)?$ $1 break;

    # 直接代理到目标主机:端口（避免在 server {} 中声明 upstream）
    # 如果配置时未填写 target_host，则默认使用宿主机 host.docker.internal
    proxy_pass http://host.docker.internal:9000;

    # 代理头设置
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # 超时设置
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;

    # 缓冲设置
    proxy_buffering on;
    proxy_buffer_size 4k;
    proxy_buffers 8 4k;
    proxy_busy_buffers_size 8k;

    # WebSocket 支持
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    # 仅在客户端请求升级时转发升级头，避免对普通请求强制发送 Connection: upgrade
    proxy_set_header Connection $http_connection;
}

